# ローパスフィルタの実装

ESP32でアナログ出力を行うことが出来るのは以下の２ピンです。

- DAC1 (GPIO25)
- DAC2 (GPIO26)

DAC2はWi-Fiと併用できないため、Wi-Fiを利用したい場合には１ピンしかアナログ出力が行えません。

## PWMを用いた平均電圧地の調整

[PWM](../practice11/ReadMe.md)を使うことで、疑似的にアナログ出力を作り出すことが出来ます。

14番ピンは通常はアナログですが、以下のようにアナログ出力を生成します。

```python
from machine import Pin, PWM
import time

# PWMピンの設定
pwm_pin = Pin(14)  # 任意のGPIOピンを使用
pwm = PWM(pwm_pin)

# PWM設定
pwm.freq(1000)  # 周波数を設定
pwm.duty(512)  # デューティサイクルを設定（0-1023の範囲）

# デューティサイクルを変更してアナログ出力をシミュレーション
while True:
    for i in range(0, 1024, 64):
        pwm.duty(i)
        time.sleep(0.1)
```

## ローパスフィルタを利用して滑らかにする

PWMを用いて信号を生成しているため、相手の周波数によっては滑らかな信号として読めないことがあります。

その際にはローパスフィルターを実装して、滑らかな出力を得る必要があります。

```lua
Vin --- R ---+--- Vout
             |
             C
             |
            GND
```

fc = 1 / 2πRC

fc: カットオフ周波数
R: 抵抗値
C: コンデンサ容量

0.1μFのコンデンサと、10kΩの抵抗を組み合わせた場合には、159.15Hzのフィルタとなり、このカットオフ周波数以上の周波数成分を減衰させます。
​
カットオフ周波数は、欲しい周波数成分が失われないように値を検討して設定する必要があります。
（1Hzに設定すると、0.5秒程度のゆっくりしたON/OFFに反応できなくなる）
